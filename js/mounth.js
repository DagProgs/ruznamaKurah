function getQueryParam(e){let t=new URLSearchParams(window.location.search);return t.get(e)}function formatTime(e){let t=String(e[0]).padStart(2,"0"),r=String(e[1]).padStart(2,"0");return`${t}:${r}`}function timeToMinutes(e){return 60*e[0]+e[1]}function getCurrentPrayer(e,t){let r=["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"],a={Fajr:"Фаджр",Sunrise:"Восход",Dhuhr:"Зухр",Asr:"Аср",Maghrib:"Магриб",Isha:"Иша"},n=null;for(let i=0;i<r.length;i++){let l=r[i],s=e[l];if(t<timeToMinutes(s)){if(0===i)n={name:a.Isha,startTime:e.Isha,endTime:e.Fajr};else{let o=r[i-1];n={name:a[o],startTime:e[o],endTime:e[l]}}break}}return n||(n={name:a.Isha,startTime:e.Isha,endTime:e.Fajr}),n}function updateCountdown(e,t,r,a,n,i){let l=document.getElementById("countdown"),s=setInterval(()=>{let n=new Date,o=60*n.getHours()+n.getMinutes(),d=e-o;if(d<0&&(d+=1440),d<=0)clearInterval(s),l.textContent="Намаз завершен!",setTimeout(()=>{displayPrayerTimes(r,a,i)},1e3);else{let u=Math.floor(d/60),m=d%60;l.textContent=`До ${t}а: ${String(u).padStart(2,"0")}:${String(m).padStart(2,"0")}`}},1e3)}function displayPrayerTimes(e,t,r){let a=document.querySelector("#prayerTable tbody");a.innerHTML="",document.getElementById("selectedCity").textContent=`${({makhachkala:"Махачкала",kurah:"Курахский район"})[r]||"Неизвестный город"}`;let n=new Date,i=n.getDate(),l=n.getFullYear(),s=`Сегодня: ${i} ${["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][n.getMonth()]} ${l}`;document.getElementById("currentDate").textContent=s;let o=e[t],d=60*n.getHours()+n.getMinutes(),u=o[i],m=getCurrentPrayer(u,d),h=document.getElementById("currentPrayer");h.textContent=`${m.name} - ${formatTime(m.startTime)}`;let y=["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"],f={Fajr:"Фаджр",Sunrise:"Восход",Dhuhr:"Зухр",Asr:"Аср",Maghrib:"Магриб",Isha:"Иша"},c=null;for(let g=0;g<y.length;g++){let p=y[g],$=u[p];if(d<timeToMinutes($)){c=f[p];break}}c||(c="Фаджр");let T=timeToMinutes(m.endTime);updateCountdown(T,c,e,t,o,r);let C={Фаджр:"fajrHeader",Восход:"sunriseHeader",Зухр:"dhuhrHeader",Аср:"asrHeader",Магриб:"maghribHeader",Иша:"ishaHeader"};for(let I of Object.values(C))document.getElementById(I).classList.remove("current-prayer-header");let M=C[m.name];for(let[w,P]of(M&&document.getElementById(M).classList.add("current-prayer-header"),Object.entries(o))){let b=document.createElement("tr"),E=document.createElement("td");for(let H of(E.textContent=w,b.appendChild(E),y)){let S=document.createElement("td");S.textContent=formatTime(P[H]),b.appendChild(S)}Number(w)===i&&b.classList.add("today"),a.appendChild(b)}}async function loadAndDisplayPrayerTimes(){try{let e=getQueryParam("file");if(!e)throw Error("Путь к файлу не указан.");let t=await fetch(e);if(!t.ok)throw Error("Ошибка загрузки файла.");let r=await t.json(),a=new Date,n=a.getMonth()+1,i=e.split("/").pop(),l=i.split(".")[0];displayPrayerTimes(r,n,l)}catch(s){console.error("Ошибка:",s),alert("Не удалось загрузить данные о времени намаза.")}}window.onload=loadAndDisplayPrayerTimes;