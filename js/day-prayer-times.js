let timerInterval=null;const cityDataCache={};async function loadPrayerTimes(t){try{if(cityDataCache[t]){console.log(`Данные для города ${t} уже загружены. Используем кэш.`),updateUI(t);return}console.log(`Загрузка данных для города: ${t}`);let e=await fetch(`data/${t}.json`);if(!e.ok)throw Error(`Ошибка при загрузке файла: ${e.status}`);let r=await e.json(),a=new Date,n=String(a.getMonth()+1),i=String(a.getDate());if(!r[n]||!r[n][i])throw Error(`Нет данных для даты: ${n}-${i} в городе ${t}`);cityDataCache[t]=r,console.log(`Данные для города ${t} успешно загружены и сохранены в кэше.`),updateUI(t)}catch(s){console.error(`Ошибка при загрузке данных для города ${t}:`,s.message),alert(`Ошибка: ${s.message}`)}}function updateUI(t){let e=new Date,r=String(e.getMonth()+1),a=String(e.getDate()),n=cityDataCache[t];if(!n||!n[r]||!n[r][a]){console.error(`Нет данных для даты: ${r}-${a} в городе ${t}`),alert(`Нет данных для даты: ${r}-${a} в городе ${t}`);return}let i=n[r][a];timerInterval&&(clearInterval(timerInterval),timerInterval=null),updatePrayerTimes(i),updateCurrentCityName(t),highlightCurrentPrayer(i),startNextPrayerTimer(i)}function updatePrayerTimes(t){document.getElementById("fajrTime").textContent=formatTime(t.Fajr),document.getElementById("sunriseTime").textContent=formatTime(t.Sunrise),document.getElementById("dhuhrTime").textContent=formatTime(t.Dhuhr),document.getElementById("asrTime").textContent=formatTime(t.Asr),document.getElementById("maghribTime").textContent=formatTime(t.Maghrib),document.getElementById("ishaTime").textContent=formatTime(t.Isha)}function formatTime(t){if(!Array.isArray(t)||2!==t.length)return"Н/Д";let e=String(t[0]).padStart(2,"0"),r=String(t[1]).padStart(2,"0");return`${e}:${r}`}function updateCurrentCityName(t){document.getElementById("currentCity").textContent=`${({kurah:"Курахский район","s.stalsk":"С.Стальский район",derbent:"Дербент",izberbash:"Избербаш",makhachkala:"Махачкала",kaspiysk:"Каспийск"})[t]||"Неизвестный город"}`}const toggleButton=document.getElementById("toggleButton"),cityList=document.getElementById("cityList");function highlightCurrentPrayer(t){let e=new Date,r=e.getHours(),a=e.getMinutes(),n={Fajr:60*t.Fajr[0]+t.Fajr[1],Sunrise:60*t.Sunrise[0]+t.Sunrise[1],Dhuhr:60*t.Dhuhr[0]+t.Dhuhr[1],Asr:60*t.Asr[0]+t.Asr[1],Maghrib:60*t.Maghrib[0]+t.Maghrib[1],Isha:60*t.Isha[0]+t.Isha[1]},i=60*r+a;document.querySelectorAll(".prayer-time p").forEach(t=>t.classList.remove("current-prayer"));let s="",l="";i<n.Sunrise?(s="Фаджр",l=formatTime(t.Fajr),document.getElementById("fajrTime").classList.add("current-prayer")):i<n.Dhuhr?(s="Шурук",l=formatTime(t.Sunrise),document.getElementById("sunriseTime").classList.add("current-prayer")):i<n.Asr?(s="Зухр",l=formatTime(t.Dhuhr),document.getElementById("dhuhrTime").classList.add("current-prayer")):i<n.Maghrib?(s="Аср",l=formatTime(t.Asr),document.getElementById("asrTime").classList.add("current-prayer")):i<n.Isha?(s="Магриб",l=formatTime(t.Maghrib),document.getElementById("maghribTime").classList.add("current-prayer")):(s="Иша",l=formatTime(t.Isha),document.getElementById("ishaTime").classList.add("current-prayer")),document.getElementById("currentPrayerName").textContent=s,document.getElementById("currentPrayerTime").textContent=l}function startNextPrayerTimer(t){let e=["Фаджр","Шурук","Зухр","Аср","Магриб","Иша"],r={Фаджр:"Fajr",Шурук:"Sunrise",Зухр:"Dhuhr",Аср:"Asr",Магриб:"Maghrib",Иша:"Isha"},a={},n=new Date;function i(){let r=new Date,n=60*r.getHours()+r.getMinutes(),i=document.getElementById("nextPrayerText"),s=document.getElementById("nextPrayerTime"),l=document.getElementById("redLine"),o="",m=1/0;for(let u=0;u<e.length;u++){let y=e[u],g=a[y];if(g>n){let d=g-n;d<m&&(m=d,o=y)}}if(o){let h=Math.floor(m/60).toString().padStart(2,"0")+":"+(m%60).toString().padStart(2,"0");i.textContent=`До ${o}а`,s.textContent=h;let c=m/(a[o]-a[e[e.indexOf(o)-1]])*100;l.style.width=100-c+"%"}else{let f=Math.floor((a["Фаджр"]+1440-n)/60).toString().padStart(2,"0")+":"+((a["Фаджр"]+1440-n)%60).toString().padStart(2,"0");i.textContent="До Фаджра",s.textContent=f,l.style.width="0%"}highlightCurrentPrayer(t)}n.getHours(),n.getMinutes(),e.forEach(function(e){let n=r[e];n&&t[n]&&(a[e]=60*t[n][0]+t[n][1])}),timerInterval=setInterval(i,1e3),i()}toggleButton.addEventListener("click",function(){"none"===cityList.style.display||""===cityList.style.display?(cityList.style.display="block",toggleButton.textContent="Рузнама -"):(cityList.style.display="none",toggleButton.textContent="Рузнама +")}),cityList.addEventListener("click",function(t){if("LI"===t.target.tagName){let e=t.target.getAttribute("data-city");loadPrayerTimes(e),cityList.style.display="none",toggleButton.textContent="Рузнама +"}}),window.onload=function(){loadPrayerTimes("kurah")};