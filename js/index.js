let currentIntervalId=null;function formatTime(e){let t=String(e[0]).padStart(2,"0"),n=String(e[1]).padStart(2,"0");return`${t}:${n}`}function timeToMinutes(e){let[t,n]=e.split(":").map(Number);return 60*t+n}function updateCountdown(e,t,n){let i=document.getElementById("countdown");currentIntervalId&&clearInterval(currentIntervalId),currentIntervalId=setInterval(()=>{let a=new Date,r=60*a.getHours()+a.getMinutes(),l=localStorage.getItem("selectedCity");if(l!==n){clearInterval(currentIntervalId);return}let m=e-r;if(m<0&&(m+=1440),m<=0)clearInterval(currentIntervalId),i.textContent="Намаз завершен!",setTimeout(()=>{loadTodayPrayerTimes(l,localStorage.getItem("selectedCityName"))},1e3);else{let d=Math.floor(m/60),s=m%60;i.textContent=`До ${t}а: ${String(d).padStart(2,"0")}:${String(s).padStart(2,"0")}`}},1e3)}async function loadTodayPrayerTimes(e="kurah",t="Курахский район"){try{currentIntervalId&&clearInterval(currentIntervalId);let n=await fetch(`js/json/${e}.min.json`);if(!n.ok)throw Error("Ошибка загрузки файла.");let i=await n.json(),a=new Date,r=a.getMonth()+1,l=a.getDate(),m=i[r][l];document.getElementById("fajrTime").textContent=formatTime(m.Fajr),document.getElementById("sunriseTime").textContent=formatTime(m.Sunrise),document.getElementById("dhuhrTime").textContent=formatTime(m.Dhuhr),document.getElementById("asrTime").textContent=formatTime(m.Asr),document.getElementById("maghribTime").textContent=formatTime(m.Maghrib),document.getElementById("ishaTime").textContent=formatTime(m.Isha),document.getElementById("cityName").innerHTML=`${t}`,document.getElementById("selectedCityForYear").textContent=t,document.getElementById("selectedCityHeader").textContent=t;let d=60*a.getHours()+a.getMinutes(),s=[{id:"fajrTime",label:"Фаджр",time:m.Fajr},{id:"sunriseTime",label:"Восход",time:m.Sunrise},{id:"dhuhrTime",label:"Зухр",time:m.Dhuhr},{id:"asrTime",label:"Аср",time:m.Asr},{id:"maghribTime",label:"Магриб",time:m.Maghrib},{id:"ishaTime",label:"Иша",time:m.Isha},];s.forEach(e=>{let t=document.getElementById(e.id);t.classList.remove("current-prayer","past-prayer","next-prayer")});let o=null,y=null;for(let c=0;c<s.length;c++){let g=timeToMinutes(formatTime(s[c].time));if(d<g){o=0===c?s[s.length-1]:s[c-1],y=s[c];break}}o||(o=s[s.length-1],y=s[0]),s.forEach(e=>{let t=document.getElementById(e.id),n=timeToMinutes(formatTime(e.time));n<d&&e.id!==o.id?t.classList.add("past-prayer"):e.id===o.id?t.classList.add("current-prayer"):e.id===y.id&&t.classList.add("next-prayer")});let I=formatTime(o.time);document.getElementById("currentPrayerInfo").textContent=`${o.label} - ${I}`;let u=timeToMinutes(formatTime(y.time));updateCountdown(u,y.label,e)}catch(T){console.error("Ошибка:",T),document.getElementById("fajrTime").textContent="Ошибка",document.getElementById("sunriseTime").textContent="Ошибка",document.getElementById("dhuhrTime").textContent="Ошибка",document.getElementById("asrTime").textContent="Ошибка",document.getElementById("maghribTime").textContent="Ошибка",document.getElementById("ishaTime").textContent="Ошибка",document.getElementById("cityName").textContent="Не удалось загрузить данные о времени намаза.",document.getElementById("currentPrayerInfo").textContent="Текущий намаз: Неизвестно (--)",document.getElementById("countdown").textContent="--:--"}}const savedCity=localStorage.getItem("selectedCity")||"kurah",savedCityName=localStorage.getItem("selectedCityName")||"Курахский район";loadTodayPrayerTimes(savedCity,savedCityName);const toggleLink=document.getElementById("toggleLink"),cityList=document.getElementById("cityList"),cityNameElement=document.getElementById("cityName");toggleLink.addEventListener("click",()=>{"none"===cityList.style.display||""===cityList.style.display?cityList.style.display="block":cityList.style.display="none"}),cityList.addEventListener("click",e=>{if("LI"===e.target.tagName){let t=e.target.getAttribute("data-file"),n=e.target.getAttribute("data-city-name"),i=t.split(".")[0];localStorage.setItem("selectedCity",i),localStorage.setItem("selectedCityName",n),cityNameElement.innerHTML=`<strong>${n}</strong>`,loadTodayPrayerTimes(i,n),cityList.style.display="none"}}),cityNameElement.addEventListener("click",()=>{let e=localStorage.getItem("selectedCity")||"makhachkala",t=`${e}.min.json`;window.location.href=`mounth.html?file=${encodeURIComponent(`js/json/${t}`)}`}),document.getElementById("yearLinkContainer").addEventListener("click",e=>{let t=localStorage.getItem("selectedCity")||"makhachkala";window.location.href=`year.html?city=${encodeURIComponent(t)}`});