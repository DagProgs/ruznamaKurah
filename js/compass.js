const compassCircle=document.querySelector(".compass-circle"),myPoint=document.querySelector(".my-point"),startBtn=document.querySelector(".start-btn"),isIOS=navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/);function init(){startBtn.addEventListener("click",startCompass),navigator.geolocation.getCurrentPosition(locationHandler),isIOS||window.addEventListener("deviceorientationabsolute",handler,!0)}function startCompass(){isIOS&&DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e?window.addEventListener("deviceorientation",handler,!0):alert("has to be allowed!")}).catch(()=>alert("not supported"))}function handler(e){compass=e.webkitCompassHeading||Math.abs(e.alpha-360),compassCircle.style.transform=`translate(-50%, -50%) rotate(${-compass}deg)`,pointDegree<Math.abs(compass)&&pointDegree+15>Math.abs(compass)||pointDegree>Math.abs(compass+15)||pointDegree<Math.abs(compass)?myPoint.style.opacity=0:pointDegree&&(myPoint.style.opacity=1)}let pointDegree;function locationHandler(e){let{latitude:t,longitude:n}=e.coords;(pointDegree=calcDegreeToPoint(t,n))<0&&(pointDegree+=360)}function calcDegreeToPoint(e,t){let n={lat:21.422487,lng:39.826206},o=n.lat*Math.PI/180,i=n.lng*Math.PI/180,a=e*Math.PI/180,r=t*Math.PI/180;return Math.round(180/Math.PI*Math.atan2(Math.sin(i-r),Math.cos(a)*Math.tan(o)-Math.sin(a)*Math.cos(i-r)))}init();